{"ast":null,"code":"var _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useNavigate } from 'react-router-dom';\nexport async function handleLogo() {\n  _s();\n  const navigate = useNavigate();\n  navigate(\"/\");\n}\n_s(handleLogo, \"CzcTeTziyjMsSrAVmHuCCb6+Bfg=\", false, function () {\n  return [useNavigate];\n});\nexport async function usePagePreCheck() {\n  _s2();\n  const navigate = useNavigate();\n  if (localStorage.getItem(\"access_token\")) {\n    try {\n      console.log(\"has access token\");\n      const access_token = localStorage.getItem(\"access_token\");\n      const response = await fetch(`http://localhost:5000/token_valid?access_token=${access_token}`);\n      const data = await response.json();\n      const IsValid = data.isValid;\n      console.log(\"data valid \" + IsValid);\n      if (IsValid) {\n        console.log(true);\n        return true;\n      } else {\n        await refreshToken(navigate);\n        return false;\n      }\n    } catch (error) {\n      console.error('Error checking validity:', error);\n      return false;\n    }\n  } else {\n    logout(navigate);\n  }\n}\n_s2(usePagePreCheck, \"CzcTeTziyjMsSrAVmHuCCb6+Bfg=\", false, function () {\n  return [useNavigate];\n});\nexport async function refreshToken(navigate) {\n  const refresh_token = localStorage.getItem(\"refresh_token\");\n  const url = \"https://accounts.spotify.com/api/token\";\n  const payload = {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded'\n    },\n    body: new URLSearchParams({\n      grant_type: 'refresh_token',\n      refresh_token: refresh_token\n      //client_id: clientId\n    })\n  };\n  try {\n    const response = await fetch(url, payload);\n    if (!response.ok) {\n      logout(navigate);\n      throw new Error('Failed to refresh token');\n    }\n    const responseData = await response.json();\n    localStorage.setItem('access_token', responseData.access_token);\n    localStorage.setItem('refresh_token', responseData.refresh_token);\n  } catch (error) {\n    throw new Error('Error refreshing token: ' + error.message);\n  }\n}\nexport function logout(navigate) {\n  localStorage.removeItem(\"access_token\");\n  localStorage.removeItem(\"refresh_token\");\n  navigate('/');\n}","map":{"version":3,"names":["useNavigate","handleLogo","_s","navigate","usePagePreCheck","_s2","localStorage","getItem","console","log","access_token","response","fetch","data","json","IsValid","isValid","refreshToken","error","logout","refresh_token","url","payload","method","headers","body","URLSearchParams","grant_type","ok","Error","responseData","setItem","message","removeItem"],"sources":["C:/Users/ethan/OneDrive/Desktop/spotify-stats-express/client/src/pages/utils.js"],"sourcesContent":["import { useNavigate } from 'react-router-dom';\r\n\r\nexport async function handleLogo() {\r\n  const navigate = useNavigate();\r\n  navigate(\"/\")\r\n}\r\nexport async function usePagePreCheck() {\r\n  const navigate = useNavigate();\r\n\r\n  if (localStorage.getItem(\"access_token\")) {\r\n    try {\r\n      console.log(\"has access token\")\r\n      const access_token = localStorage.getItem(\"access_token\");\r\n      const response = await fetch(`http://localhost:5000/token_valid?access_token=${access_token}`);\r\n      const data = await response.json();\r\n      const IsValid = data.isValid;\r\n      console.log(\"data valid \"+ IsValid)\r\n\r\n      if (IsValid) {\r\n        console.log(true);\r\n        return true;\r\n      } else {\r\n        await refreshToken(navigate);\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.error('Error checking validity:', error);\r\n      return false;\r\n    }\r\n  } else {\r\n    logout(navigate)\r\n  }\r\n}\r\n\r\nexport async function refreshToken(navigate) {\r\n  const refresh_token = localStorage.getItem(\"refresh_token\");\r\n  const url = \"https://accounts.spotify.com/api/token\";\r\n\r\n  const payload = {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/x-www-form-urlencoded'\r\n    },\r\n    body: new URLSearchParams({\r\n      grant_type: 'refresh_token',\r\n      refresh_token: refresh_token,\r\n      //client_id: clientId\r\n    }),\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(url, payload);\r\n    if (!response.ok) {\r\n      logout(navigate)\r\n      throw new Error('Failed to refresh token');\r\n    }\r\n\r\n    const responseData = await response.json();\r\n\r\n    localStorage.setItem('access_token', responseData.access_token);\r\n    localStorage.setItem('refresh_token', responseData.refresh_token);\r\n  } catch (error) {\r\n    throw new Error('Error refreshing token: ' + error.message);\r\n  }\r\n}\r\n\r\nexport function logout(navigate) {\r\n  localStorage.removeItem(\"access_token\");\r\n  localStorage.removeItem(\"refresh_token\");\r\n  navigate('/')\r\n}\r\n"],"mappings":";;AAAA,SAASA,WAAW,QAAQ,kBAAkB;AAE9C,OAAO,eAAeC,UAAUA,CAAA,EAAG;EAAAC,EAAA;EACjC,MAAMC,QAAQ,GAAGH,WAAW,CAAC,CAAC;EAC9BG,QAAQ,CAAC,GAAG,CAAC;AACf;AAACD,EAAA,CAHqBD,UAAU;EAAA,QACbD,WAAW;AAAA;AAG9B,OAAO,eAAeI,eAAeA,CAAA,EAAG;EAAAC,GAAA;EACtC,MAAMF,QAAQ,GAAGH,WAAW,CAAC,CAAC;EAE9B,IAAIM,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC,EAAE;IACxC,IAAI;MACFC,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC;MAC/B,MAAMC,YAAY,GAAGJ,YAAY,CAACC,OAAO,CAAC,cAAc,CAAC;MACzD,MAAMI,QAAQ,GAAG,MAAMC,KAAK,CAAE,kDAAiDF,YAAa,EAAC,CAAC;MAC9F,MAAMG,IAAI,GAAG,MAAMF,QAAQ,CAACG,IAAI,CAAC,CAAC;MAClC,MAAMC,OAAO,GAAGF,IAAI,CAACG,OAAO;MAC5BR,OAAO,CAACC,GAAG,CAAC,aAAa,GAAEM,OAAO,CAAC;MAEnC,IAAIA,OAAO,EAAE;QACXP,OAAO,CAACC,GAAG,CAAC,IAAI,CAAC;QACjB,OAAO,IAAI;MACb,CAAC,MAAM;QACL,MAAMQ,YAAY,CAACd,QAAQ,CAAC;QAC5B,OAAO,KAAK;MACd;IACF,CAAC,CAAC,OAAOe,KAAK,EAAE;MACdV,OAAO,CAACU,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MAChD,OAAO,KAAK;IACd;EACF,CAAC,MAAM;IACLC,MAAM,CAAChB,QAAQ,CAAC;EAClB;AACF;AAACE,GAAA,CA1BqBD,eAAe;EAAA,QAClBJ,WAAW;AAAA;AA2B9B,OAAO,eAAeiB,YAAYA,CAACd,QAAQ,EAAE;EAC3C,MAAMiB,aAAa,GAAGd,YAAY,CAACC,OAAO,CAAC,eAAe,CAAC;EAC3D,MAAMc,GAAG,GAAG,wCAAwC;EAEpD,MAAMC,OAAO,GAAG;IACdC,MAAM,EAAE,MAAM;IACdC,OAAO,EAAE;MACP,cAAc,EAAE;IAClB,CAAC;IACDC,IAAI,EAAE,IAAIC,eAAe,CAAC;MACxBC,UAAU,EAAE,eAAe;MAC3BP,aAAa,EAAEA;MACf;IACF,CAAC;EACH,CAAC;EAED,IAAI;IACF,MAAMT,QAAQ,GAAG,MAAMC,KAAK,CAACS,GAAG,EAAEC,OAAO,CAAC;IAC1C,IAAI,CAACX,QAAQ,CAACiB,EAAE,EAAE;MAChBT,MAAM,CAAChB,QAAQ,CAAC;MAChB,MAAM,IAAI0B,KAAK,CAAC,yBAAyB,CAAC;IAC5C;IAEA,MAAMC,YAAY,GAAG,MAAMnB,QAAQ,CAACG,IAAI,CAAC,CAAC;IAE1CR,YAAY,CAACyB,OAAO,CAAC,cAAc,EAAED,YAAY,CAACpB,YAAY,CAAC;IAC/DJ,YAAY,CAACyB,OAAO,CAAC,eAAe,EAAED,YAAY,CAACV,aAAa,CAAC;EACnE,CAAC,CAAC,OAAOF,KAAK,EAAE;IACd,MAAM,IAAIW,KAAK,CAAC,0BAA0B,GAAGX,KAAK,CAACc,OAAO,CAAC;EAC7D;AACF;AAEA,OAAO,SAASb,MAAMA,CAAChB,QAAQ,EAAE;EAC/BG,YAAY,CAAC2B,UAAU,CAAC,cAAc,CAAC;EACvC3B,YAAY,CAAC2B,UAAU,CAAC,eAAe,CAAC;EACxC9B,QAAQ,CAAC,GAAG,CAAC;AACf"},"metadata":{},"sourceType":"module","externalDependencies":[]}